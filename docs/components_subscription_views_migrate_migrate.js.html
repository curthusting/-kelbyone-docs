<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Adding meta -->
    

    <!-- Adding external script-->
    

    <!-- Adding external style-->
    

    <!-- Adding scripts-->
    

    <!-- Adding style-->
    

    <!-- Adding overlay script-->
    

    <!-- Adding overlay style-->
    


    <title>
      components/subscription/views/migrate/migrate.js
    </title>

    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/third-party/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/third-party/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/reset.css">
    <link type="text/css" rel="stylesheet" href="styles/heading.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-base.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-light.css">
    
    <style>
      .accordion {padding-left: 15px} .param-type dd {font-family: 'body', font-size: 100%}
    </style>
    
    <svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
    style="display:none">
    <defs>
        <symbol id="copy-icon" viewbox="0 0 488.3 488.3">
            <g>
                <path
                    d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z" />
                <path
                    d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z" />
            </g>
        </symbol>
        <symbol id='search-icon' viewBox="0 0 512 512">
            <g>
                <g>
                    <path
                        d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z" />
                </g>
            </g>
            <g>
                <g>
                    <path
                        d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z" />
                </g>
            </g>
        </symbol>
        <symbol id="down-icon" viewBox="0 0 16 16">
            <path 
                fill-rule="evenodd" 
                clip-rule="evenodd" 
                d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"
            >
            </path>
        </symbol>
    </defs>
</svg>
  </head>

  <body>

    <nav class="navbar" id="navbar">
      <div class="navbar-heading" id="navbar-heading"><a href="index.html"><h2 class="navbar-heading-text">Home</h2></a></div><div class="search-box" id="search-box"><div class="search-box-input-container"><input class="search-box-input" type="text" placeholder="Search..." id="search-box-input" /><svg class="search-icon" alt="search-icon"><use xlink:href="#search-icon"></use></svg></div><div class="search-item-container" id="search-item-container"><ul class="search-item-ul" id="search-item-ul"></ul></div></div><div class="sidebar-main-content" id="sidebar-main-content"><div class="accordion collapsed" id="4945604" > <h3 class="accordion-heading">Modules<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion-list" id=""><a href="Account_Payment_Profiles.html">Account:Payment_Profiles</a></li><li class="accordion-list" id=""><a href="Auth_Login-Register.html">Auth:Login-Register</a></li><li class="accordion-list" id=""><a href="Purchase_Bundle.html">Purchase:Bundle</a></li><li class="accordion-list" id=""><a href="Purchase_Course.html">Purchase:Course</a></li><li class="accordion-list" id=""><a href="Purchase_Cyber.html">Purchase:Cyber</a></li><li class="accordion-list" id=""><a href="Purchase_Gift.html">Purchase:Gift</a></li><li class="accordion-list" id=""><a href="Purchase_Redeem.html">Purchase:Redeem</a></li><li class="accordion-list" id=""><a href="Purchase_Subscription.html">Purchase:Subscription</a></li><li class="accordion-list" id=""><a href="Subscription_Change-Plan.html">Subscription:Change-Plan</a></li><li class="accordion-list" id=""><a href="Subscription_Migrate.html">Subscription:Migrate</a></li><li class="accordion-list" id=""><a href="Subscription_Pay.html">Subscription:Pay</a></li><li class="accordion-list" id=""><a href="Subscription_Renew.html">Subscription:Renew</a></li></ul> </div><div class="accordion collapsed" id="813276" > <h3 class="accordion-heading">Interfaces<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion-list" id=""><a href="Config.html">Config</a></li><li class="accordion-list" id=""><a href="Config.Api.html">Api</a></li><li class="accordion-list" id=""><a href="Product.html">Product</a></li><li class="accordion-list" id=""><a href="ProductDetails.html">ProductDetails</a></li><li class="accordion-list" id=""><a href="Products.html">Products</a></li><li class="accordion-list" id=""><a href="Response.html">Response</a></li><li class="accordion-list" id=""><a href="User.html">User</a></li></ul> </div></div>
      

    </nav>
    <div class="navbar-ham" id="navbar-ham">
      <div>
        <div class="first"></div>
        <div class="second"></div>
        <div class="third"></div>
      </div>
    </div>

    <div id="main" class="main-content">
      
      <h1 id='page-title' class="page-title">
        components/subscription/views/migrate/migrate.js
      </h1>
      

      



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { reactive, inject, ref, computed } from 'vue';

import AuthLoginRegisterComponent from '@/components/auth/blocks/login-register/login-register.vue';
import PurchaseProductSelectComponent from '@/components/purchase/blocks/product-select/product-select.vue';
import PaymentBillingDetailsComponent from '@/components/payment/blocks/billing-details/billing-details.vue';
import PurchaseSummaryComponent from '@/components/purchase/blocks/summary/summary.vue';
import PurchaseNextPaymentComponent from '@/components/purchase/blocks/next-payment/next-payment.vue';

/**
 * Subscription Migrate View
 * @module Subscription:Migrate
 *
 * @prop { Config } config Component configuration
 * @prop { Products } products Product details
 * @prop { User } user Authenticated user details
 *
 * @see [Components Example]{@link https://kelbystaging.wpengine.com/checkout-components/?component=subscription-migrate-view&amp;products=korm-pro-monthly&amp;products=korm-pro-annual&amp;selected=korm-pro-annual&amp;user=139167&amp;token=6094485c4050b0.49135056} Please DO NOT submit this form or it will break the demo
 *
 * @example
  koc("loadComponent", {
    name: "subscription-migrate-view",
    el: "#kelbyone-component-view",
    props: {
      config: { ... },
      products: { options: [{ ... }], selected: ... },
      user: { ... },
    }
  });
 *
 */

export default {
  name: 'SubscriptionMigrateView',
  props: {
    config: {
      type: Object,
      required: false,
      default: null,
    },
    user: {
      type: Object,
      required: false,
      default: null,
    },
    products: {
      type: Object,
      required: false,
      default: null,
    },
  },
  components: {
    AuthLoginRegisterComponent,
    PurchaseProductSelectComponent,
    PaymentBillingDetailsComponent,
    PurchaseSummaryComponent,
    PurchaseNextPaymentComponent,
  },
  setup() {
    let config = inject('config');
    config = { ...config, ...props.config };

    const authProvider = inject('authProvider');
    const customerProvider = inject('customerProvider');
    const subscriptionProvider = inject('subscriptionProvider');

    const state = reactive({
      expanded: ref(1),
      showNotification: ref(false),
      notification: ref(null),
      terms: ref(false),
      user: computed(() => authProvider().getUser),
      isLoadingUser: computed(() => authProvider().isLoading),
      selected: computed(() => subscriptionProvider().getProduct),
      coupon: computed(() => subscriptionProvider().getCoupon),
      payment: computed(() => subscriptionProvider().getProfile),
      preview: computed(() => subscriptionProvider().getPreview),
      hasProfiles: computed(() => customerProvider().hasProfiles),
      profiles: computed(() => customerProvider().getProfiles),
      defaultProfile: computed(() => customerProvider().getDefaultProfile),
      selectedProfile: computed(() => subscriptionProvider().getProfile),
      canSubmit: computed(() => state.selected &amp;&amp; state.payment &amp;&amp; state.terms)
    });

    const handleResponse = async (response) => {
      if (response.status === 'error') {
        state.showNotification = true;
        state.notification = response.data.message || response.data.data.message || response.data.data;
      } else {
        state.showNotification = false;
        state.notification = null;
      }
    };

    const updateProduct = async (product, toggle = true) => {
      state.showNotification = true;
      state.notification = 'Updating Selection...';

      const response = await subscriptionProvider().updateProduct(product, props.products.options, config);

      await handleResponse(response);

      if ('success' === response.status &amp;&amp; toggle) state.expanded = 2;
    };

    if (props.products.selected) {
      updateProduct(props.products.selected, false);
    }

    const loadCustomer = async (customer, token) => {
      state.showNotification = true;
      state.notification = 'Loading Customer...';
      await customerProvider().loadCustomer(customer, token, config);

      state.showNotification = true;
      state.notification = 'Updating Customer...';
      let response = await subscriptionProvider().updateCustomer(customer, token, config);

      if (customerProvider().hasCustomerMembership) {
        state.showNotification = true;
        state.notification = 'Loading Membership...';
        const membership = await customerProvider().getCustomerMembership;
        response = await subscriptionProvider().updateMembership(membership, config);
      }
      await handleResponse(response);
    }

    const loadUser = async (user) => {
      state.showNotification = true;
      state.notification = 'Loading User...';

      const { id, token } = user;

      let response = await authProvider().loadUser(id, token, config);
      await handleResponse(response);

      if ('success' === response.status) {
        const { data } = response.data;
        response = await loadCustomer(data.customer.id, data.token)
      }
    };

    if (props.user) {
      loadUser(props.user);
    } else {
      state.isExpanded = true;
    }

    const login = async (data) => {
      state.showNotification = true;
      state.notification = 'Validating Credentials...';

      const { username, password } = data;
      const response = await authProvider().login(username, password, config);
      await handleResponse(response);

      if ('success' === response.status) {
        const { data } = response.data;
        await loadCustomer(data.customer.id, data.token)
      }
    };

    const register = async (data) => {
      state.showNotification = true;
      state.notification = 'Creating Account...';

      const { firstname, lastname, email, username, password, confirm } = data;
      const response = await authProvider().register(firstname, lastname, email, username, password, confirm, config);
      await handleResponse(response);

      if ('success' === response.status) {
        const { data } = response.data;
        response = await loadCustomer(data.customer.id, data.token)
      }
    };

    const createPayment = async (details) => {
      state.showNotification = true;
      state.notification = 'Creating Payment Method...';

      const response = await customerProvider().createPayment(details, state.user.token, config);

      await handleResponse(response);
    }

    const updatePayment = async (details) => {
      state.showNotification = true;
      state.notification = 'Updating Payment Method...';

      const response = await subscriptionProvider().updateProfile(details.id, config);

      await handleResponse(response);

      // if ('success' === response.status) {
      //   state.expanded = 3;
      // }
    }

    const removePayment = async (details) => {
      state.showNotification = true;
      state.notification = 'Removing Payment Method...';

      const response = await customerProvider().removePayment(details.id, state.user.token, config);

      await handleResponse(response);
    }

    const purchase = async () => {
      state.showNotification = true;
      state.notification = 'Purchasing...';

      const response = await subscriptionProvider().purchase(config);

      await handleResponse(response);
    }

    const clearNotification = async () => state.showNotification = false;
    const toggleExpanded = async (number) => number === state.expanded ? state.expanded = 0 : state.expanded = number;

    return { login, register, updateProduct, createPayment, updatePayment, removePayment, purchase, clearNotification, toggleExpanded, state };
  },
};</code></pre>
        </article>
    </section>




    </div>

    <footer class="footer" id="footer">
      
    </footer>

    <script src="scripts/third-party/prettify.js"></script>
    <script src="scripts/third-party/lang-css.js"></script>
    <script type="text/javascript" src="scripts/misc.js"></script>

    <script>prettyPrint();</script>
    <script src="scripts/linenumber.js"></script>
    <script src="scripts/fix-code-block.js"></script>
    <script src="scripts/fix-navbar.js"></script>
    
      <script src="scripts/search.js"></script>
      <script src="scripts/third-party/fuse.js"></script>
      <script>
        var list = [{"title":"Account:Payment_Profiles","link":"<a href=\"Account_Payment_Profiles.html\">Account:Payment_Profiles</a>"},{"title":"Auth:Login-Register","link":"<a href=\"Auth_Login-Register.html\">Auth:Login-Register</a>"},{"title":"Purchase:Bundle","link":"<a href=\"Purchase_Bundle.html\">Purchase:Bundle</a>"},{"title":"Purchase:Course","link":"<a href=\"Purchase_Course.html\">Purchase:Course</a>"},{"title":"Purchase:Cyber","link":"<a href=\"Purchase_Cyber.html\">Purchase:Cyber</a>"},{"title":"Purchase:Gift","link":"<a href=\"Purchase_Gift.html\">Purchase:Gift</a>"},{"title":"Purchase:Redeem","link":"<a href=\"Purchase_Redeem.html\">Purchase:Redeem</a>"},{"title":"Purchase:Subscription","link":"<a href=\"Purchase_Subscription.html\">Purchase:Subscription</a>"},{"title":"Subscription:Change-Plan","link":"<a href=\"Subscription_Change-Plan.html\">Subscription:Change-Plan</a>"},{"title":"Subscription:Migrate","link":"<a href=\"Subscription_Migrate.html\">Subscription:Migrate</a>"},{"title":"Subscription:Pay","link":"<a href=\"Subscription_Pay.html\">Subscription:Pay</a>"},{"title":"Subscription:Renew","link":"<a href=\"Subscription_Renew.html\">Subscription:Renew</a>"},{"title":"Config","link":"<a href=\"Config.html\">Config</a>"},{"title":"Api","link":"<a href=\"Config.Api.html\">Api</a>"},{"title":"Product","link":"<a href=\"Product.html\">Product</a>"},{"title":"ProductDetails","link":"<a href=\"ProductDetails.html\">ProductDetails</a>"},{"title":"Products","link":"<a href=\"Products.html\">Products</a>"},{"title":"Response","link":"<a href=\"Response.html\">Response</a>"},{"title":"User","link":"<a href=\"User.html\">User</a>"}];
        var options = 
          setupSearch(list, options)
      </script>
    

    

    

    

    


  </body>

</html>