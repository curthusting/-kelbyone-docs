<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Adding meta -->
    

    <!-- Adding external script-->
    

    <!-- Adding external style-->
    

    <!-- Adding scripts-->
    

    <!-- Adding style-->
    

    <!-- Adding overlay script-->
    

    <!-- Adding overlay style-->
    


    <title>
      providers/customer.provider.js
    </title>

    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/third-party/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/third-party/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/reset.css">
    <link type="text/css" rel="stylesheet" href="styles/heading.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-base.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-light.css">
    
    <style>
      .accordion {padding-left: 15px} .param-type dd {font-family: 'body', font-size: 100%}
    </style>
    
    <svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
    style="display:none">
    <defs>
        <symbol id="copy-icon" viewbox="0 0 488.3 488.3">
            <g>
                <path
                    d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z" />
                <path
                    d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z" />
            </g>
        </symbol>
        <symbol id='search-icon' viewBox="0 0 512 512">
            <g>
                <g>
                    <path
                        d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z" />
                </g>
            </g>
            <g>
                <g>
                    <path
                        d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z" />
                </g>
            </g>
        </symbol>
        <symbol id="down-icon" viewBox="0 0 16 16">
            <path 
                fill-rule="evenodd" 
                clip-rule="evenodd" 
                d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"
            >
            </path>
        </symbol>
    </defs>
</svg>
  </head>

  <body>

    <nav class="navbar" id="navbar">
      <div class="navbar-heading" id="navbar-heading"><a href="index.html"><h2 class="navbar-heading-text">Home</h2></a></div><div class="search-box" id="search-box"><div class="search-box-input-container"><input class="search-box-input" type="text" placeholder="Search..." id="search-box-input" /><svg class="search-icon" alt="search-icon"><use xlink:href="#search-icon"></use></svg></div><div class="search-item-container" id="search-item-container"><ul class="search-item-ul" id="search-item-ul"></ul></div></div><div class="sidebar-main-content" id="sidebar-main-content"><div class="accordion collapsed" id="6594337" > <h3 class="accordion-heading">Modules<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion-list" id=""><a href="Auth_Login-Register.html">Auth:Login-Register</a></li><li class="accordion-list" id=""><a href="Purchase_Bundle.html">Purchase:Bundle</a></li><li class="accordion-list" id=""><a href="Purchase_Course.html">Purchase:Course</a></li><li class="accordion-list" id=""><a href="Purchase_Cyber.html">Purchase:Cyber</a></li><li class="accordion-list" id=""><a href="Purchase_Gift.html">Purchase:Gift</a></li><li class="accordion-list" id=""><a href="Purchase_Redeem.html">Purchase:Redeem</a></li><li class="accordion-list" id=""><a href="Purchase_Subscription.html">Purchase:Subscription</a></li><li class="accordion-list" id=""><a href="Subscription_Change-Plan.html">Subscription:Change-Plan</a></li><li class="accordion-list" id=""><a href="Subscription_Migrate.html">Subscription:Migrate</a></li><li class="accordion-list" id=""><a href="Subscription_Pay.html">Subscription:Pay</a></li><li class="accordion-list" id=""><a href="Subscription_Renew.html">Subscription:Renew</a></li></ul> </div><div class="accordion collapsed" id="9634062" > <h3 class="accordion-heading">Interfaces<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion-list" id=""><a href="Config.html">Config</a></li><li class="accordion-list" id=""><a href="Config.Api.html">Api</a></li><li class="accordion-list" id=""><a href="Product.html">Product</a></li><li class="accordion-list" id=""><a href="ProductDetails.html">ProductDetails</a></li><li class="accordion-list" id=""><a href="Products.html">Products</a></li><li class="accordion-list" id=""><a href="Response.html">Response</a></li><li class="accordion-list" id=""><a href="User.html">User</a></li></ul> </div></div>
      

    </nav>
    <div class="navbar-ham" id="navbar-ham">
      <div>
        <div class="first"></div>
        <div class="second"></div>
        <div class="third"></div>
      </div>
    </div>

    <div id="main" class="main-content">
      
      <h1 id='page-title' class="page-title">
        providers/customer.provider.js
      </h1>
      

      



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import {
  reactive, computed, ref, readonly,
} from 'vue';

import { Api } from '@/services/api.service';

const state = reactive({
  customer: ref(null),
  membership: ref(null),
  profile: ref(null),
  profiles: ref(null),
  isLoading: ref(false),
  isCreating: ref(false),
  isUpdating: ref(false)
});

/**
 * @memberof Providers.Customer
 * @instance
 * @summary Sets the customer state as the provided object.
 * @param { object } customer - The customer object.
 * @returns { void } 
 */
const setCustomer = async (customer = {}) => {
  const membership = await customer.subscriptions.filter((subscription) => subscription.type === 'membership')[0];
  state.profiles = customer.profiles;
  // if (customer.profiles &amp;&amp; 1 === customer.profiles.length) state.profile = customer.profiles[0].id;
  if (membership) {

    state.membership = membership.id;
    // if (membership.current.profile.id) {

    //   state.profile = membership.current.profile.id;
    // }
  }
  state.customer = customer;
};

/**
 * @memberof Providers.Customer
 * @instance
 * @summary Attempts to load a customer with the provided id and token.
 * @param { string } id - The customer id.
 * @param { string } token - The token.
 * @param { Config } config - The component configuration.
 * @implements {@link Services.Api#fetch|Services.Api.fetch()}
 * @returns { Response } 
 * @throws { Error }
 */
const loadCustomer = async (id, token, config) => {
  if (config.debug) {
    console.log('Providers.Customer:loadCustomer():submitted data', { id, token, config });
  }
  if (!config.api.uri) {
    return Error('Providers.Customer:loadCustomer() | Api config is required to retreive customer information.');
  }
  if (!token) {
    return Error('Providers.Customer:loadCustomer() | User token is required.');
  }
  if (!id) {
    return Error('Providers.Customer:loadCustomer() | Customer id is required.');
  }

  state.isLoading = true;
  const url = `${config.api.uri}/${config.api.version}/customers/${id}?token=${token}&amp;now=${Date.now()}`;
  const response = await Api.fetch(url);
  state.isLoading = false;

  if (config.debug) {
    console.log('Providers.Customer:loadCustomer():response data', response);
  }

  if (response.status === 'error') {
    setCustomer(null);
    return response;
  }

  setCustomer(response.data.data);
  return response;
};

const createPayment = async (details, token, config) => {
  if (config.debug) {
    console.log('Providers.Customer:createPayment():submitted data', { details, token, config });
  }
  if (!details) {
    return Error('Providers.Customer:createPayment() | Payment Details are required to create customer payment.');
  }
  if (!token) {
    return Error('Providers.Customer:createPayment() | Token is required to create customer payment.');
  }
  if (!config.api.uri) {
    return Error('Providers.Customer:createPayment() | Api config is required to create customer payment.');
  }
  let url = `${config.api.uri}/${config.api.version}/customers/${state.customer.id}/profiles?token=${token}&amp;now=${Date.now()}`;

  const headers = new Headers();
  headers.append('Accept', 'application/json');
  headers.append('Content-Type', 'application/json');

  const response = await Api.post(url, details, headers);
  if (config.debug) {
    console.log('Providers.Customer:createPayment():response', response);
  }
  return await loadCustomer(state.customer.id, token, config);
}

const removePayment = async (payment, token, config) => {
  if (config.debug) {
    console.log('Providers.Customer:removePayment():submitted data', { payment, token, config });
  }

  let url = `${config.api.uri}/${config.api.version}/customers/${state.customer.id}/profiles/${payment}?token=${token}&amp;now=${Date.now()}`;

  const response = await Api.remove(url);
  if (config.debug) {
    console.log('Providers.Customer:removePayment():response', response);
  }
  return await loadCustomer(state.customer.id, token, config);
}

const updatePayment = async (payment) => state.profile = payment

/**
 * KelbyOne Customer Provider
 * @namespace Providers.Customer
 * @ignore
 * @summary KelbyOne Customer Provider
 * @property { Boolean } isLoading General loading state.
 * @property { Boolean } isCreating General creating state.
 * @property { Boolean } isUpdating General updating state.
 * @property { Object | null } getCustomer Returns the state of the customer.
 * @property { Boolean } hasCustomer Returns whether a customer exists.
 * @property { Object | null } getCustomerProfiles Returns the state of the customer payment profiles.
 * @property { Boolean } hasCustomerProfiles Returns whether a customer has payment profiles.
 * @property { Object | null } getCustomerSubscriptions Returns the state of the customer subscriptions.
 * @property { Boolean } hasCustomerSubscriptions Returns whether a customer has subscriptions.
 * @property { Object | null } getCustomerMembership Returns the state of the customer membership.
 * @property { Boolean } hasCustomerMembership Returns whether a customer has a KelbyOne membership.
 */
export default function CustomerProvider() {
  return readonly({
    loadCustomer,
    setCustomer,
    createPayment,
    removePayment,
    updatePayment,
    // General
    isLoading: computed(() => Boolean(state.isLoading)),
    isCreating: computed(() => Boolean(state.isCreating)),
    isUpdating: computed(() => Boolean(state.isUpdating)),
    // Customer
    getCustomer: computed(() => state.customer),
    hasCustomer: computed(() => Boolean(state.customer)),
    // Default Profile
    getDefaultProfile: computed(() => state.profile),
    hasDefaultProfile: computed(() => Boolean(state.profile)),
    // Profiles
    getProfiles: computed(() => state.profiles),
    hasProfiles: computed(() => Boolean(state.profiles)),
    // Subscriptions
    getSubscriptions: computed(() => state.subscriptions),
    hasSubscriptions: computed(() => Boolean(state.customer &amp;&amp; state.customer.subscriptions &amp;&amp; state.customer.subscriptions.length)),
    // Membership
    getCustomerMembership: computed(() => state.membership),
    hasCustomerMembership: computed(() => Boolean(state.membership)),
  });
}
</code></pre>
        </article>
    </section>




    </div>

    <footer class="footer" id="footer">
      
    </footer>

    <script src="scripts/third-party/prettify.js"></script>
    <script src="scripts/third-party/lang-css.js"></script>
    <script type="text/javascript" src="scripts/misc.js"></script>

    <script>prettyPrint();</script>
    <script src="scripts/linenumber.js"></script>
    <script src="scripts/fix-code-block.js"></script>
    <script src="scripts/fix-navbar.js"></script>
    
      <script src="scripts/search.js"></script>
      <script src="scripts/third-party/fuse.js"></script>
      <script>
        var list = [{"title":"Auth:Login-Register","link":"<a href=\"Auth_Login-Register.html\">Auth:Login-Register</a>"},{"title":"Purchase:Bundle","link":"<a href=\"Purchase_Bundle.html\">Purchase:Bundle</a>"},{"title":"Purchase:Course","link":"<a href=\"Purchase_Course.html\">Purchase:Course</a>"},{"title":"Purchase:Cyber","link":"<a href=\"Purchase_Cyber.html\">Purchase:Cyber</a>"},{"title":"Purchase:Gift","link":"<a href=\"Purchase_Gift.html\">Purchase:Gift</a>"},{"title":"Purchase:Redeem","link":"<a href=\"Purchase_Redeem.html\">Purchase:Redeem</a>"},{"title":"Purchase:Subscription","link":"<a href=\"Purchase_Subscription.html\">Purchase:Subscription</a>"},{"title":"Subscription:Change-Plan","link":"<a href=\"Subscription_Change-Plan.html\">Subscription:Change-Plan</a>"},{"title":"Subscription:Migrate","link":"<a href=\"Subscription_Migrate.html\">Subscription:Migrate</a>"},{"title":"Subscription:Pay","link":"<a href=\"Subscription_Pay.html\">Subscription:Pay</a>"},{"title":"Subscription:Renew","link":"<a href=\"Subscription_Renew.html\">Subscription:Renew</a>"},{"title":"Config","link":"<a href=\"Config.html\">Config</a>"},{"title":"Api","link":"<a href=\"Config.Api.html\">Api</a>"},{"title":"Product","link":"<a href=\"Product.html\">Product</a>"},{"title":"ProductDetails","link":"<a href=\"ProductDetails.html\">ProductDetails</a>"},{"title":"Products","link":"<a href=\"Products.html\">Products</a>"},{"title":"Response","link":"<a href=\"Response.html\">Response</a>"},{"title":"User","link":"<a href=\"User.html\">User</a>"}];
        var options = 
          setupSearch(list, options)
      </script>
    

    

    

    

    


  </body>

</html>